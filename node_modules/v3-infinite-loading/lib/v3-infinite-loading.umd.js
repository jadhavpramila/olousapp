(function(s,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(s=typeof globalThis!="undefined"?globalThis:s||self,e(s.V3InfiniteLoading={},s.Vue))})(this,function(s,e){"use strict";var R="",E=(t,n)=>{for(const[o,r]of n)t[o]=r;return t};const I={},q=t=>(e.pushScopeId("data-v-39432f99"),t=t(),e.popScopeId(),t),V={class:"container"},L=[q(()=>e.createElementVNode("div",{class:"spinner"},null,-1))];function N(t,n){return e.openBlock(),e.createElementBlock("div",V,L)}var k=E(I,[["render",N],["__scopeId","data-v-39432f99"]]);const B=t=>({loading(){t.value="loading"},loaded(){t.value="loaded"},complete(){t.value="complete"},error(){t.value="error"}}),H=(t,n)=>()=>{n.loading(),t("infinite",n)},b=(t,n)=>{const o=t.getBoundingClientRect(),r=n.getBoundingClientRect();return o.top-r.top<=n.clientHeight||!n.clientHeight},w=(t,{state:n,distance:o,emitInfiniteEvent:r,top:i})=>()=>{const{scrollTop:f,scrollHeight:u,clientHeight:_}=t,p=n.value=="loaded"||!n.value;i&&Math.ceil(f)-o<=0&&p&&r(),!i&&Math.ceil(f)+_>=u-o&&p&&r()};let g;const h=t=>{if(t.target&&!document.querySelector(t.target))return console.error("Vue3 infinite loading: target prop should be a valid css selector");const n=document.querySelector(t.target)||document.documentElement,o=document.querySelector(t.target)||window,r=t.vue3InfiniteLoading.value;b(r,n)&&t.firstLoad&&t.emitInfiniteEvent(),g=w(n,t),o.addEventListener("scroll",g)},m=t=>{(document.querySelector(t.target)||window).removeEventListener("scroll",g)};var x="";const T={class:"state-error"},C={props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:100},identifier:{required:!1},firstLoad:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(t,{emit:n}){const o=t,r=e.ref(null),i=e.ref(""),{top:f,target:u,distance:_,firstLoad:p,slots:v}=o,{identifier:S}=e.toRefs(o),d={vue3InfiniteLoading:r,state:i,target:u,distance:_,top:f,firstLoad:p,emitInfiniteEvent:H(n,B(i))},M=(c,a)=>e.watch(i,l=>{l=="loaded"&&f&&(Promise.resolve().then(()=>{c.scrollTop=c.scrollHeight-a}),a=c.scrollHeight),l=="complete"&&m(d)}),$=()=>e.watch(S,()=>{i.value="",m(d),h(d)});return e.onMounted(()=>{h(d);let c=document.querySelector(u)||document.documentElement,a=c.scrollHeight;M(c,a),S&&$()}),e.onUnmounted(()=>{m(d)}),(c,a)=>(e.openBlock(),e.createElementBlock("div",{ref:(l,y)=>{y.vue3InfiniteLoading=l,r.value=l}},[i.value=="loading"?e.renderSlot(c.$slots,"spinner",{key:0},()=>[e.createVNode(k)]):e.createCommentVNode("v-if",!0),i.value=="complete"?e.renderSlot(c.$slots,"complete",{key:1},()=>{var l;return[e.createElementVNode("span",null,e.toDisplayString(((l=e.unref(v))==null?void 0:l.complete)||"No more results!"),1)]}):e.createCommentVNode("v-if",!0),i.value=="error"?e.renderSlot(c.$slots,"error",{key:2,retry:d.emitInfiniteEvent},()=>{var l;return[e.createElementVNode("span",T,[e.createElementVNode("span",null,e.toDisplayString(((l=e.unref(v))==null?void 0:l.error)||"Oops something went wrong!"),1),e.createElementVNode("button",{class:"retry",onClick:a[0]||(a[0]=(...y)=>d.emitInfiniteEvent&&d.emitInfiniteEvent(...y))},"retry")])]}):e.createCommentVNode("v-if",!0)],512))}};s.default=C,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
